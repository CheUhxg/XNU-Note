# Kernel ASLR（KASLR，iOS 6）

## 机制是什么
KASLR 随机化 kernelcache 映像在内核地址空间的基址，导致内核函数/全局符号地址不再固定。

## 对利用链的影响
- survey 强调：现代 iOS 内核利用几乎都需要**绕过或工作在 KASLR 之下**。
- 常见做法：
  - 信息泄露得到 kernel text 指针或 vtable 指针，从而推导 slide
  - 先拿到内核读原语，再扫描定位 kernel text base（在某些链路里出现）

## 常见“绕过路径”（在 survey 多条目中出现）
- 读取某对象 vtable 指针 → 推导 slide
- 泄露内核指针（例如未初始化内存 copyout）
- brute force 某类指针（在部分链路中与 fake clock port 等组合出现）

## 参考内容摘要

**核心机制**：KASLR（Kernel Address Space Layout Randomization）随机化内核加载基址，使内核代码、数据、函数地址每次启动都不同。攻击者无法依赖固定地址进行 ROP、gadget 执行或 vtable 劫持。

**对现代利用的影响**：几乎所有 iOS kernel exploit 都需要绕过 KASLR。主要方法包括：①信息泄露（OOB 读、UAF、uninitialized memory）获得内核指针（vtable、函数指针、全局数据）；②推导 kernel slide（泄露值 − 已知符号地址 = slide）；③brute force 猜测（某些链通过反复调用可预测的系统调用与时间度量间接推导）；④被动泄露（未初始化堆喷射已知值后触发 OOB 读来搜索值在堆中的位置）。

**绕过现状**：survey 统计显示，iOS 6 引入 KASLR 后，所有公开链（iTw Chain 1-5、voucher_swap、sockpuppet 等）都包含 KASLR 绕过步骤，通常涉及（a）vtable 泄露 + 符号计算，（b）kernel_task + ipc_port 泄露，或（c）驱动级原语（OOB 读/write）直接探测。

**缓解评估**：KASLR 有效阻止了基于固定地址的简单 exploit，但与其他缓解（PAN、PAC）不同，它完全依赖信息泄露的困难程度。当存在可靠的泄露原语时，KASLR 被认为是可绕过的。

## 参考
- Survey：iOS kernel exploit mitigations / Kernel ASLR
