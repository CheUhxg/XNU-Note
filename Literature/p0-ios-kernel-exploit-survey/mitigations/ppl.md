# PPL（Page Protection Layer，iOS 12）

## 机制是什么
PPL 是建立在 APRR（并依赖 KTRR）的软件层，目标是在“拥有 kernel r/w/x”与“直接控制页表/映射敏感物理地址”之间建立边界。其重点之一是保护已签名用户态代码页，防止攻击者用内核读写去篡改用户态进程的可执行代码。

## 对利用链的影响（survey 的归纳）
- survey 结论（截至 2020-05）：PPL 尚无公开绕过；但当时公开的 iOS 10–13 本地内核利用总体上**还没有被 PPL 显著阻断**。
- 学习上要注意：即使有 kernel r/w，后续能做什么（例如持久化修改 page tables、写入受保护区域）可能被 PPL 限制。

## 参考内容摘要

**核心机制**：PPL（Page Protection Layer，iOS 12+）建立在 APRR 和 KTRR 基础上，在内核与页表/物理内存管理之间添加软件层。其核心目标：①禁止内核代码直接修改页表项；②保护 PPL-marked 页（如用户态代码页）免被内核读写篡改；③创建"拥有内核读写能力"与"直接控制内存映射"之间的权限分离。

**对现代利用的影响**：PPL 限制了基于"内核读写 → 修改页表 → 得到持久化执行权"的经典 exploit 路线。即使攻击者获得内核任意读写，也无法直接修改页表或映射新的可执行页。这对长期 persistence 和跨进程代码执行造成挑战。PPL 也保护了内核可信 context（SPRR/APRR protected regions），使得某些旁通道和 side-channel 攻击难度上升。

**绕过现状**：survey 截至 2020-05 未公开 PPL 绕过（与 KTRR/APRR 的情况不同）。但大多数公开的 iOS 10-13 本地 kernel exploit 主要目标是"单次代码执行"（例如 jailbreak 触发或 sandboxing 逃逸），而非持久化修改；因此尚未大规模触发 PPL 限制。

**缓解评估**：PPL 在防御持久化和特权提升上表现较好，但对短期利用（如本地 jailbreak）影响有限。与 PAC 共同使用时防御力度倍增。

## 参考
- Survey：iOS kernel exploit mitigations / PPL
