# APRR（iOS 11，对应 A11+）

## 机制是什么
APRR（一种自定义硬件特性）将页表权限位间接化：PTE 中的权限位变成索引，真正的权限由寄存器控制，可按核原子切换一组页的权限。

## 对利用链的影响（survey 的归纳）
- APRR 本身不直接提供边界，但为在同一地址空间内部做权限分层创造条件。
- 它被 PPL 大量使用，用于在内核内部建立更强的安全边界。

## 参考内容摘要

**核心机制**：APRR（Apple Proprietary Read/Write Register，iOS 15+）是苹果自研的内存保护机制，利用 ARM 未文档的寄存器和异常处理扩展。在指定虚拟地址范围建立 RW 权限的非对称性：kernel 在某些上下文（SPRR state）中无法读写特定内存，但用户态或特定中断处理程序可以。目标是保护关键内核数据结构（如页表、任务结构、中断向量表）。

**对现代利用的影响**：APRR 与 PPL 协作，进一步强化了"拥有内核读写 ≠ 能修改所有内核数据"的模型。即使达到内核代码执行或读写，也可能因 APRR 限制而无法访问受保护区域。这对"读内核数据结构找泄露点"和"修改关键内核对象"的策略造成直接挑战。

**绕过现状**：survey 主要关注 iOS 10-13，对 APRR（iOS 15+）的绕过未深入讨论。已知的避免方案包括利用 SPRR state 转换的竞态窗口和搜索未被 APRR 保护的替代数据结构。

**缓解评估**：APRR 作为现代 iOS 最新的缓解之一，显著提升了内存保护的粒度，但依赖于正确的实现和 CPU 硬件的支持。

## 参考
- APRR 研究文献（Apple security documentation）
- Survey：iOS kernel exploit mitigations / APRR
