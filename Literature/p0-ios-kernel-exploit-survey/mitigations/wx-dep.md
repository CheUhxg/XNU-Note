# W^X / DEP（iOS 6）

## 机制是什么
W^X（write xor execute）要求内核页要么可写要么可执行；DEP 强调数据页不可执行，减少注入 shellcode 的传统路线。

## 对利用链的影响
- survey 总结：现代公开 iOS 内核利用通常不尝试改页表注入代码，而是：
  - 篡改内核数据结构
  - 代码复用（调用已有内核代码路径、gadget、间接调用）
- 这也与更强的硬件机制（如 KTRR）共同作用。

## 参考内容摘要

**核心机制**：WX/DEP（Write XOR Execute，Dual Execution Prevention）在 CPU 硬件层级禁止内存页同时具有写权限和执行权限。页表项中 XN（Execute Never）位与 W（Write）位互斥（或由 OS 强制互斥），阻止 RWX 页的出现。

**对现代利用的影响**：WX/DEP 禁止了"在堆或数据段注入 shell code 并执行"的基础套路。Kernel exploit 因此依赖于 ROP/JOP（在既有可执行代码中跳跃执行），或通过 gadget（如 OSSerializer）实现高级功能。这大幅提升了 exploit 设计复杂度，但同时也刺激了 gadget 和 ROP 技术的发展（例如 Sparkes 的 gadget 库、Project Zero 的 JOP chain）。

**绕过现状**：WX/DEP 在硬件层实现且强制，完整绕过极其困难（除非通过 KTRR 漏洞修改页表）。现代 exploit 几乎全部采用 ROP/JOP 或 gadget，而非试图绕过 WX。

**缓解评估**：WX/DEP 是现代 exploit mitigation 中最成功的之一，几乎使得"注入 shell code 在内核执行"完全不可行，大幅提升了 exploit 的技术复杂度和代码审计难度。

## 参考
- Survey：iOS kernel exploit mitigations / WX/DEP
- Survey：iOS kernel exploit mitigations / W^X / DEP
