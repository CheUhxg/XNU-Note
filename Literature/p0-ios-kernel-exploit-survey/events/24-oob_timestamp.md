# oob_timestamp

- 目标系统: iOS 13.3
- CVE: CVE-2020-3837

## 初始原语（primitive）
IOAccelCommandQueue2::processSegmentKernelCommand() 线性堆 OOB 写（最多 8 字节 timestamp）。

## 漏洞特定利用策略（strategy）
通过大规模内核 map 布局与 IOSurface OSData spray，溢出破坏 ipc_kmsg.ikm_size 变大；释放后用 OSData 重占位 OOL ports array 并插入 hardcoded 地址处 fake port 指针。

## 后续通用利用流程（subsequent exploit flow）
接收 OOL ports 得到 fake port receive right；用 pid_for_task 建读原语；定位对象并构造 fake kernel task port。

## 关键可复用技术点（techniques）
- 扩大 ipc_kmsg size 制造重叠窗口
- 共享内存/大块落点辅助稳定重叠
- pid_for_task 读

## 与缓解机制的关系（notes）
- survey 注记：iOS 13 的 zone_require 会影响 fake port；该条目提到一次实现疏漏绕过。

## 参考
- [Ian Beer IOKit timestamp OOB research](https://bugs.chromium.org/p/project-zero/issues/detail?id=1598)

### 参考内容摘要

**原文概述**：iOS 12.4 IOKit timestamp 相关 OOB 访问（CVE 未公开）。IOSurfaceServer 或相关驱动在处理时间戳相关参数时，数组索引边界检查遗漏导致越界读写。Exploit 策略：①构造超大或负值时间戳参数；②IOKit 解析时绕过检查访问超界；③读超界数据泄露指针；④搜索特征定位 kernel_task 地址；⑤KASLR 破解；⑥写超界数据污染 ipc_port 或 vm_map 结构；⑦构造 dangling port 或修改权限；⑧pid_for_task + task_for_pid 链；⑨任意代码执行。关键技术：时间戳参数滥用导致索引计算错误、OOB 读泄露 + 写控制、跨驱动调用图扩大利用面。
- [exploit code](https://bugs.chromium.org/p/project-zero/issues/detail?id=1986#c5)
