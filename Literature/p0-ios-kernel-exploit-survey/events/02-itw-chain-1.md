# In-the-wild iOS Exploit Chain 1

- 目标系统: iOS 10.1.1
- CVE: （survey 条目未给出或为多漏洞）

## 初始原语（primitive）
AGXAllocationList2::initWithSharedResourceList() 线性堆 OOB 写，覆盖相邻结构指针。

## 漏洞特定利用策略（strategy）
通过布局让溢出覆盖 recv_msg_elem.uio；用 IOSurface 管理的 OSData 伪造 uio 并反复释放/重分配。

## 后续通用利用流程（subsequent exploit flow）
通过外部方法/OSSerializer::serialize gadget 实现任意 read-then-write，把 kernel task port 地址写入当前 task special ports，再从 userspace 读回得到 port right。

## 关键可复用技术点（techniques）
- IOSurface/OSData 作为可控分配载体
- OSSerializer::serialize gadget
- special ports 通道

## 与缓解机制的关系（notes）
- in-the-wild 复盘，细节以引用文章为准。

## 参考
- [writeup](https://projectzero.google/2019/08/in-wild-ios-exploit-chain-1.html)

### 参考内容摘要

**原文概述**：这是 Google Project Zero 的 Ian Beer 在 2019 年 8 月公开的针对 iOS 10.0.1-10.1.1 野外利用链深度分析（Chain 1）。漏洞位于 com.apple.AGX 驱动中 `AGXAllocationList2::initWithSharedResourceList` 方法对用户传入结构长度字段的验证不一致，导致可控堆溢出。利用核心堆喷射（heap grooming）手法：先用大量管道（pipes）和 Mach 端口分配占位，再用 IOSurface properties + OSData/OSString 对象进行精细堆布局，通过反复触发和替换 ipc_kmsg 结构，最终构建 fake kernel task port。后利用阶段包括：通过 kernel r/w 定位 launchd ucred 结构实现权限提升、补丁平台策略字节码允许任意执行、通过 trust cache 注入恶意 CDHash 绕过代码签名、最终以 root 身份执行监控植入物。该链证明攻击者掌握与 iOS 版本同期编写的 exploit 能力，已持续至少两年拥有针对全补丁 iPhone 的攻击手段。文中强调多个经典技术：IOSurface 作为 heap groom 工具、OOL ports/memory descriptors 进行内核堆管理、pid_for_task/clock_sleep_trap trick 用于信息泄露和 KASLR 绕过、以及 pipe buffers 承载伪造内核对象等。
