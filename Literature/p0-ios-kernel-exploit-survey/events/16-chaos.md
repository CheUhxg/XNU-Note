# Chaos

- 目标系统: iOS 12.1.2
- CVE: CVE-2019-6225

## 初始原语（primitive）
task_swap_mach_voucher() MIG lifetime 语义问题导致 ipc_voucher UAF。

## 漏洞特定利用策略（strategy）
喷射 vouchers 并触发漏洞降低 refcount 释放；释放同页并做 zone GC 让 ith_voucher dangling。

## 后续通用利用流程（subsequent exploit flow）
OSString/IOSurface 读回泄露 voucher port 地址；大 spray 在硬编码地址附近构造 fake port 并更新 iv_port；thread_get_mach_voucher 得到 fake port right；pid_for_task 建读；转 fake map port remap；构造 fake kernel task port。

## 关键可复用技术点（techniques）
- thread_get_mach_voucher 关键转换点
- IOSurface 读回泄露
- remap 使对象可持续更新

## 与缓解机制的关系（notes）
- survey 注记：A12 PAC 与 iOS12 port finalize 缓解改变常见结构。

## 参考
- [exploit code](https://bugs.chromium.org/p/project-zero/issues/detail?id=1578#c8)

### 参考内容摘要

**原文概述**：chaos（iOS 11.4.1，socket 层漏洞 CVE-2018-4363）。IPv6 SO_REUSEPORT 超大值写破坏邻接 ipc_port；得到 dangling port；zone gc 后 pipe buffer 重占位构造可控 fake port；pid_for_task 读原语；虚构内核 task port。Exploit：①socket 数组邻接 ipc_port 的 groom；②超大索引值摧毁 port；③dangling → pipe → fake 流程；④pid_for_task 实现读原语。关键技术：socket 索引超界写 → ipc_port 破坏、dangling port 链、pipe 可控化。与 sockpuppet 的 race 方案对比。
- [360 blog](https://blogs.360.cn/post/IPC%20Voucher%20UaF%20Remote%20Jailbreak%20Stage%202%20(EN).html)
