# Spice (LightSpeed)

- 目标系统: iOS 11.4.1
- CVE: （可能）CVE-2018-4344

## 初始原语（primitive）
lio_listio() race 导致 UAF；通过 OOL ports array + IOSurface spray 获得可控 fake port right。

## 漏洞特定利用策略（strategy）
一线程循环触发 race；另一线程发送 OOL ports array 并喷射 kalloc.16，race 赢时用假数组重占位；接收得到 fake port receive right。

## 后续通用利用流程（subsequent exploit flow）
notification 泄露地址；mach_port_get_attributes 建读原语；定位对象；转 fake user client 用 iokit_user_client_trap 得到 7 参数任意调用；构造 fake kernel task port。

## 关键可复用技术点（techniques）
- kalloc.16 race + spray
- notification 泄露
- fake user client + trap 任意调用

## 与缓解机制的关系（notes）
- survey 注记：PAN 启用时不可用。

## 参考
- [exploit code](https://bugs.chromium.org/p/project-zero/issues/detail?id=1584#c6)

### 参考内容摘要

**原文概述**：spice（iOS 11.4.1，A11 GPU 二阶漏洞）。AGXAccelerator 未初始化堆读导致 OOB 访问；通过特征搜索定位内核对象并读取地址。Exploit：①堆喷 + 碎片化造成已知值分布；②AGXAccelerator 触发漏洞读碎片；③搜索识别值位置边界；④读邻近 ipc_port 破 KASLR；⑤构造假内核 task port（不完整）。关键技术：未初始化堆二阶搜索、值识别定位、GPU 驱动级内存污染。
- [LightSpeed writeup](https://www.synacktiv.com/posts/exploit/lightspeed-a-race-for-an-iosmacos-sandbox-escape.html)
- [code](https://github.com/JakeBlair420/Spice)
