# multi_path

- 目标系统: iOS 11.3.1
- CVE: CVE-2018-4241

## 初始原语（primitive）
mptcp_usr_connectx bounds check 错误导致 intra-object 线性堆溢出，可污染指针低字节并通过 kfree 制造 UAF。

## 漏洞特定利用策略（strategy）
让 ipc_kmsg 位于特定对齐边界附近；两次触发使同地址被释放/复用，得到 dangling pipe buffer。

## 后续通用利用流程（subsequent exploit flow）
用 preallocated ipc_kmsg 与异常消息制造重叠，读 pipe 得到地址；改写 ipc_kmsg 使接收得到 pipe buffer 内 fake port 的 send right；转 pid_for_task 读原语；构造 fake kernel task port。

## 关键可复用技术点（techniques）
- 指针低字节污染 + kfree 形成可控复用
- pipe buffer 作为容器
- 异常消息与 ipc_kmsg 重叠

## 与缓解机制的关系（notes）
- （略）

## 参考
- [exploit code](https://bugs.chromium.org/p/project-zero/issues/detail?id=1558#c3)

### 参考内容摘要

**原文概述**：multi_path（Ian Beer 针对 iOS 11.3.1 的 CVE-2018-4241 MPTCP exploit）。mptcp_usr_connectx 中 bounds check 错误导致 intra-object 线性堆溢出，可污染指针低字节并通过 kfree 制造 UAF。Exploit 策略：①让 ipc_kmsg 位于特定对齐边界附近；②触发 bug 使同地址对象被两次释放，得到 dangling pipe buffer；③用 preallocated ipc_kmsg 与异常消息制造重叠，读 pipe 得到地址；④改写 ipc_kmsg 使接收得到 pipe buffer 内 fake port 的 send right；⑤转 pid_for_task 读原语；⑥构造 fake kernel task port。关键技术：指针低字节污染 + kfree 形成可控复用、pipe buffer 作为容器、异常消息与 ipc_kmsg 重叠实现地址泄露。该链展示弱原语（指针低字节污染）的多级利用。
