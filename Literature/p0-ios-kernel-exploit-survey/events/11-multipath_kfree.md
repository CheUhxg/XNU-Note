# multipath_kfree

- 目标系统: iOS 11.3.1
- CVE: CVE-2018-4241

## 初始原语（primitive）
同 CVE-2018-4241 的另一条链：通过部分释放/重叠最终达到可控虚调用与任意调用原语。

## 漏洞特定利用策略（strategy）
多次触发制造 hole 与部分释放 ipc_kmsg；用 mach_port_peek 定位；喷射填洞读取自指针泄露地址；再次触发释放留下已知地址对象。

## 后续通用利用流程（subsequent exploit flow）
AGXCommandQueue 重占位，读 vtable 破 KASLR；通过消息重叠更新对象，劫持虚调用到 OSSerializer::serialize gadget，形成 3 参数任意调用（通过异常消息更新参数）。

## 关键可复用技术点（techniques）
- mach_port_peek 探测
- vtable 泄露破 KASLR
- gadget + 重叠更新构造任意调用

## 与缓解机制的关系（notes）
- 细节密度高，建议对照代码。

## 参考
- [exploit code](https://github.com/potmdehex/multipath_kfree)

### 参考内容摘要

**原文概述**：multipath_kfree（同 CVE-2018-4241 的另一条链）。通过部分释放/重叠最终达到可控虚调用与任意调用原语。Exploit 策略：①多次触发制造 hole 与部分释放 ipc_kmsg；②用 mach_port_peek 定位；③喷射填洞读取自指针泄露地址；④再次触发释放留下已知地址对象；⑤AGXCommandQueue 重占位，读 vtable 破 KASLR；⑥通过消息重叠更新对象，劫持虚调用到 OSSerializer::serialize gadget，形成 3 参数任意调用；⑦用异常消息更新参数。关键技术：mach_port_peek 探测、vtable 泄露破 KASLR、gadget + 重叠更新构造任意调用。细节密集，需对照代码理解。
