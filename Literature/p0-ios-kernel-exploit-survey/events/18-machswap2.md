# machswap2

- 目标系统: iOS 12.1.2
- CVE: CVE-2019-6225

## 初始原语（primitive）
dangling voucher + OSString/IOSurface，最终得到 pipe buffers 内 fake port right。

## 漏洞特定利用策略（strategy）
OSString 重占位并在 thread_get_mach_voucher 时泄露 voucher port 地址。

## 后续通用利用流程（subsequent exploit flow）
pipe buffers spray（在泄露地址后约 1MB）；更新 iv_port 指向 pipe buffers；再次 thread_get_mach_voucher 得到 fake port right；pid_for_task 建读；构造 fake kernel task port。

## 关键可复用技术点（techniques）
- IOSurface 读回泄露
- 距离假设 + pipe spray
- pid_for_task 读

## 与缓解机制的关系（notes）
- survey 注记：有 pre-PAN 与 PAN-enabled 两版本；此为 PAN-enabled。

## 参考
- [code](https://github.com/PsychoTea/machswap2)
- [blog](https://sparkes.zone/blog/ios/2019/04/30/machswap-ios-12-kernel-exploit.html)
