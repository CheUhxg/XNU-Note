# AppleAVE2Driver exploit

- 目标系统: iOS 12.4.1（条目注记：<= 13.1.3 也受影响）
- CVE: CVE-2019-8795 + CVE-2019-8794

## 初始原语（primitive）
CVE-2019-8795：内存破坏/受控虚调用或任意 kfree；CVE-2019-8794：未初始化栈数据泄露破 KASLR。

## 漏洞特定利用策略（strategy）
先泄露 KASLR slide；IOSurface OSData 喷射 fake task ports；触发漏洞释放硬编码地址处的 OSData 形成 dangling；通过 OOL ports array 构造 rights 与指针插入。

## 后续通用利用流程（subsequent exploit flow）
用 pid_for_task 读关键对象指针；再通过释放/重分配升级为 fake kernel task port。

## 关键可复用技术点（techniques）
- 信息泄露破 KASLR
- OSData + OOL ports 指针/rights 搬运
- pid_for_task 读

## 与缓解机制的关系（notes）
- survey 注记：有 non-PAC 与 PAC 两版本；此为 PAC 版本。

## 参考
- Related work on AppleAVE2 vulnerabilities

### 参考内容摘要

**原文概述**：AppleAVE2 video encoding 驱动多漏洞组合（iOS 12 era）。包含：①内存初始化错误导致未初始化指针可泄；②memory read/write OOB 在缓冲区操作中；③UAF 在命令队列清空时。Exploit 策略：①触发初始化漏洞读取堆内未初始化数据；②通过特征搜索定位 vtable；③KASLR 破解；④触发 OOB 写污染邻接数据结构；⑤构造 fake IOAudioStream 或类似驱动对象；⑥接收特殊消息时跳过验证；⑦虚调用执行任意调用 gadget；⑧特权提升代码执行。关键技术：驱动初始化漏洞导致数据泄露、OOB 写与对象注入、gadget 利用。展示媒体驱动的复杂漏洞集合。
- [ZecOps blog](https://blog.zecops.com/vulnerabilities/releasing-first-public-task-for-pwn0-tfp0-granting-poc-on-ios/)
- [ZecOps repo](https://github.com/ZecOps/public/tree/master/ZecOps_FreeTheSandbox_iOS_PAC_TFP0_POC_BEQ_12_4_2)
- [SSD advisory](https://ssd-disclosure.com/ssd-advisory-via-ios-jailbreak-sandbox-escape-and-kernel-r-w-leading-to-rce/)
